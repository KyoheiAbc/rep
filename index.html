<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: hsl(0, 0%, 16%);
            height: 100dvh;
            width: 100dvw;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            background-color: hsl(0, 0%, 32%);
            height: 98dvh;
            width: 49dvh;
        }
    </style>
</head>

<body>
    <canvas id="canvas" width="256" height="512"></canvas>
    <script>
        class Input {
            #start = null;
            #queue = [];
            static #THRESHOLD = 32;
            static #DIR = {
                RIGHT: 6,
                LEFT: 4,
                DOWN: 2,
                UP: 8
            };

            constructor() {
                addEventListener("pointerdown", e => this.#start = {
                    x: e.clientX,
                    y: e.clientY
                });
                addEventListener("pointermove", e => this.#onMove(e));
                addEventListener("pointerup", () => this.#start = null);
            }

            #onMove(e) {
                if (!this.#start) return;
                const dx = e.clientX - this.#start.x,
                    dy = e.clientY - this.#start.y;
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > Input.#THRESHOLD) this.#queue.push(Input.#DIR.RIGHT), this.#start.x += dx;
                    else if (dx < -Input.#THRESHOLD) this.#queue.push(Input.#DIR.LEFT), this.#start.x += dx;
                } else {
                    if (dy > Input.#THRESHOLD) this.#queue.push(Input.#DIR.DOWN), this.#start.y += dy;
                    else if (dy < -Input.#THRESHOLD) this.#queue.push(Input.#DIR.UP), this.#start.y += dy;
                }
            }

            poll() {
                return this.#queue.shift() ?? null;
            }
        }

        class Ball {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.radius = 16;
            }
        }

        class CanvasRenderer {
            constructor(canvas) {
                this.ctx = canvas.getContext("2d");
                this.canvas = canvas;
            }

            draw(balls) {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                balls.forEach(b => {
                    this.ctx.fillStyle = `hsl(${(b.color - 1) * 60},100%,50%)`;
                    this.ctx.beginPath();
                    this.ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }
        }

        class Game {
            constructor(canvas) {
                this.input = new Input();
                this.renderer = new CanvasRenderer(canvas);
                this.balls = [
                    new Ball(16, 16, Game.randColor()),
                    new Ball(48, 48, Game.randColor()),
                    new Ball(80, 80, Game.randColor()),
                ];
                this.activeBall = new Ball(112, 48, Game.randColor());
                this.balls.push(this.activeBall);
            }

            static randColor() {
                return Math.floor(Math.random() * 4) + 1;
            }

            update() {
                this.input.poll();
                this.renderer.draw(this.balls);
            }

            run() {
                setInterval(() => this.update(), 1000 / 60);
            }
        }

        new Game(document.getElementById("canvas")).run();
    </script>
</body>

</html>