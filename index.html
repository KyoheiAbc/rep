<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: hsl(0, 0%, 16%);
            height: 100dvh;
            width: 100dvw;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            background-color: hsl(0, 0%, 32%);
            height: 98dvh;
            width: 49dvh;
        }
    </style>
</head>

<body>
    <canvas id="canvas" width="256" height="512"></canvas>
    <script>
        class InputManager {
            #start = null;
            #inputs = [];
            static #THRESHOLD = 32;
            static #DIRECTIONS = {
                RIGHT: 6,
                LEFT: 4,
                DOWN: 2,
                UP: 8
            };

            constructor() {
                addEventListener("pointerdown", e => this.#onDown(e));
                addEventListener("pointermove", e => this.#onMove(e));
                addEventListener("pointerup", () => this.#start = null);
            }

            #onDown(e) {
                this.#start = {
                    x: e.clientX,
                    y: e.clientY
                };
            }

            #onMove(e) {
                if (!this.#start) return;
                const dx = e.clientX - this.#start.x;
                const dy = e.clientY - this.#start.y;
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > InputManager.#THRESHOLD) {
                        this.#inputs.push(InputManager.#DIRECTIONS.RIGHT);
                        this.#start.x += dx;
                    } else if (dx < -InputManager.#THRESHOLD) {
                        this.#inputs.push(InputManager.#DIRECTIONS.LEFT);
                        this.#start.x += dx;
                    }
                } else {
                    if (dy > InputManager.#THRESHOLD) {
                        this.#inputs.push(InputManager.#DIRECTIONS.DOWN);
                        this.#start.y += dy;
                    } else if (dy < -InputManager.#THRESHOLD) {
                        this.#inputs.push(InputManager.#DIRECTIONS.UP);
                        this.#start.y += dy;
                    }
                }
            }

            getInput() {
                return this.#inputs.shift() ?? null;
            }
        }

        const input = new InputManager();

        setInterval(() => {
            console.log(input.getInput());
        }, 1000 / 60);
    </script>
</body>

</html>